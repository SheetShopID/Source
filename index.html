<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop Loader</title>
<style>
  body { font-family: Arial; padding:20px; }
  .card { border:1px solid #ddd;padding:15px;margin:10px;border-radius:10px; }
  img { width:100%; border-radius:10px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<h2 id="shopName">Loading shop...</h2>
<div id="productList"></div>

<script>
// 1. Ambil subdomain
const host = window.location.hostname;
const shopId = host.split(".")[0];

// 2. URL Firebase (ganti ini)
const FIREBASE_URL = "https://tokoinstan-3e6d5-default-rtdb.firebaseio.com/shops.json";

async function getShop() {
  const res = await fetch(FIREBASE_URL);
  const data = await res.json();
  return data.shops?.[shopId] || null;
}

// 3. Ambil CSV
async function getProducts(sheetUrl) {
  const res = await fetch(sheetUrl);
  const text = await res.text();
  return Papa.parse(text, { header: true }).data;
}

// 4. Render
function renderProducts(list) {
  const container = document.getElementById("productList");
  container.innerHTML = "";

  list.forEach(p => {
    container.innerHTML += `
      <div class="card">
        <img src="${p.Img1 || ''}">
        <h3>${p.Name}</h3>
        <p>${p.Price}</p>
      </div>
    `;
  });
}

// 5. Init
(async () => {
  const shop = await getShop();
  if (!shop) {
    document.body.innerHTML = "<h1>Toko tidak ditemukan</h1>";
    return;
  }

  document.getElementById("shopName").textContent = shop.name;

  const products = await getProducts(shop.sheetUrl);
  renderProducts(products);
})();
</script>

</body>
</html>
